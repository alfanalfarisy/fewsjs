extends ../layout/base
block content  
	//- section.content-header
		
	// Main content
	section.content
		// Your Page Content Here
		// /.row
		.row
			.col-12
				- if (messages.msg_error)
					.alert.alert-danger.alert-dismissable
						button.close(type='button', data-dismiss='alert', aria-hidden='true') ×
						| #{messages.msg_error}
				- if (messages.msg_info)
					.alert.alert-success.alert-dismissable
						button.close(type='button', data-dismiss='alert', aria-hidden='true') ×
						| #{messages.msg_info}
				.card
					.card-header
						h3.card-title Account
					.card-body.table-responsive.no-padding

						table.table.table-striped
							thead
								th No.
								th Username
								th Email
								th No
								th Nama Depan
								th Nama Belakang
								th Admin
								th Action
							tbody.tableContent
	#editModal.modal
		.modal-dialog
			.modal-content
				// Modal Header
				.modal-header
					h4.modal-title Alfan Alfarisy
					button.close(type='button', data-dismiss='modal') ×
				// Modal body
				.modal-body
						.form-group.row
							label.col-sm-4.col-form-label(for='inputUsername' require) Username
							.col-sm-8
								input#inputUsername.form-control(type='text' readonly require)
						.form-group.row
							label.col-sm-4.col-form-label(for='inputFirstname' require) Nama Pertama
							.col-sm-8
								input#inputFirstname.form-control(type='text' require)
						.form-group.row
							label.col-sm-4.col-form-label(for='inputLastname') Nama Terakhir
							.col-sm-8
								input#inputLastname.form-control(type='text' require)
						.form-group.row
							label.col-sm-4.col-form-label(for='inputEmail' ) Email
							.col-sm-8
								input#inputEmail.form-control(type='email' require)
						.form-group.row
							label.col-sm-4.col-form-label(for='inputNohp') No HP
							.col-sm-8
								input#inputNohp.form-control(type='text', autocomplete='off' require)
						.form-group.row
							label.col-sm-4.col-form-label(for='inputPassword') Password
							.col-sm-8
								input#inputPass.form-control(type='text' , autocomplete='off' require)

				.modal-footer
					button.btn.btn-primary(type='button', data-dismiss='modal') Close
					button.btn.btn-primary(type='button', onclick='save(`edit`)' data-dismiss='modal') Save

block script
	script.
		var socket = io.connect(BASE_URL);
		var users= !{users}

		
		function show(usersData){
			var i=1;
			var txt;
			$(".remove").remove();
			usersData.forEach((data)=>{
				txt += "<tr class = 'remove'><td>"+i+"</td>"+
				"<td>"+data.username+"</td>"+
				"<td>"+data.email+"</td>"+
				"<td>"+data.no+"</td>"+
				"<td>"+data.firstname+"</td>"+
				"<td>"+data.lastname+"</td>"+
				"<td>"+data.admin+"</td>"+
				"<td>"+
				"<div class='btn-group' role='group' aria-label='Basic example'>"+
					"<button class='btn btn-info' onclick = editBtn(`"+data.username+"`)>Edit</button>"+
				"</div>"+
				"</td></tr>"
				i++
			})
			$('.tableContent').after(txt)
		} 
		show(users)
		socket.on('users',(users)=>{
			var data=users
			show(data)

		})

		function editBtn(username){
			var user = users.filter(function (user) {return user.username == username})
			if(user.length==0){
				alert('Data tidak ada / lakukan reload halaman')
			} else{
				user = user[0]
				$("#inputUsername").val(user.username);
				$("#inputFirstname").val(user.firstname);
				$("#inputLastname").val(user.lastname);
				$("#inputEmail").val(user.email);
				$("#inputPass").val(user.password);
				$("#inputNohp").val(user.no);
				$('#editModal').modal('show');
			}
		}

		function save(action){
			var status = $("#inputStatus").val()
			status = ()=>{
				return status == 'true' ? true : false 
			}
			status = status()
			data= {
				'username' : $("#inputUsername").val(),
				'firstname' : $("#inputFirstname").val(),
				'lastname' : $("#inputLastname").val(),
				'email' : $("#inputEmail").val(),
				'no' : $("#inputNohp").val(),
				'pass' : $("#inputPass").val(),
				'admin' : status
				}

			console.log(data)
			
			saveBtn = (action)=>{
				socket.emit('editProfile', data )
			}
			saveBtn()
		}
